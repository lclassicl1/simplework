<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>통신사 양식 변환기</title>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background-color: #f5f5f5;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background-color: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 0 15px rgba(0, 0, 0, 0.1);
        }

        h1 {
            text-align: center;
            margin-bottom: 20px;
            color: #333;
        }

        .layout-container {
            display: flex;
            gap: 20px;
        }

        .input-column {
            flex: 1;
        }

        .output-column {
            flex: 1;
        }

        .form-group {
            margin-bottom: 15px;
        }

        .form-row {
            display: flex;
            gap: 15px;
            margin-bottom: 15px;
        }

        .form-row .form-group {
            flex: 1;
            margin-bottom: 0;
        }

        label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
            color: #555;
        }

        select, textarea, input[type="text"] {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 14px;
        }

        select {
            background-color: white;
            cursor: pointer;
        }

        textarea {
            resize: vertical;
        }

        .input-textarea {
            min-height: 300px;
        }

        .output-textarea {
            min-height: 300px;
        }

        .button-group {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
        }

        button {
            padding: 10px 15px;
            border: none;
            border-radius: 5px;
            font-size: 14px;
            cursor: pointer;
            transition: background-color 0.3s;
        }

        #convertBtn {
            background-color: #4CAF50;
            color: white;
            flex: 2;
        }

        #convertBtn:hover {
            background-color: #45a049;
        }

        #copyBtn {
            background-color: #2196F3;
            color: white;
            flex: 1;
        }

        #copyBtn:hover {
            background-color: #0b7dda;
        }

        #clearBtn {
            background-color: #f44336;
            color: white;
            flex: 1;
        }

        #clearBtn:hover {
            background-color: #d32f2f;
        }

        #outputText {
            background-color: #f9f9f9;
        }

        .output-section {
            background-color: #f9f9f9;
            padding: 15px;
            border-radius: 5px;
            margin-bottom: 15px;
        }

        .output-section h3 {
            margin-bottom: 10px;
            color: #333;
        }
        
        /* URL 선택박스 스타일 */
        .url-container {
            margin-bottom: 20px;
            text-align: right;
        }
        
        .url-select {
            width: auto;
            min-width: 200px;
            padding: 8px 12px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 14px;
            background-color: #f8f9fa;
            cursor: pointer;
        }
        
        /* 대리점 메모 팝업 스타일 */
        .info-button {
            background-color: #4CAF50;
            color: white;
            border: none;
            border-radius: 50%;
            width: 24px;
            height: 24px;
            font-size: 14px;
            cursor: pointer;
            margin-left: 10px;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            vertical-align: middle;
        }
        
        .info-button:disabled {
            background-color: #cccccc;
            cursor: not-allowed;
        }
        
        .popup-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }
        
        .popup-content {
            background-color: white;
            padding: 20px;
            border-radius: 5px;
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.3);
            max-width: 500px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
            position: relative;
        }
        
        .popup-close {
            position: absolute;
            top: 10px;
            right: 10px;
            font-size: 20px;
            cursor: pointer;
            color: #666;
        }
        
        .popup-title {
            margin-top: 0;
            color: #333;
            border-bottom: 1px solid #eee;
            padding-bottom: 10px;
            margin-bottom: 15px;
        }
        
        .memo-content {
            white-space: pre-line;
            line-height: 1.5;
        }
        
        /* 키-값 테이블 스타일 */
        .key-value-table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 20px;
        }
        
        .key-value-table th {
            background-color: #f5f5f5;
            padding: 8px 12px;
            text-align: left;
            font-weight: bold;
            border: 1px solid #ddd;
            width: 30%;
        }
        
        .key-value-table td {
            padding: 8px 12px;
            border: 1px solid #ddd;
            cursor: pointer;
            position: relative;
            transition: background-color 0.2s;
        }
        
        .key-value-table td:hover {
            background-color: #f0f8ff;
        }
        
        .key-value-table td::after {
            content: "클릭하여 복사";
            position: absolute;
            right: 10px;
            color: #999;
            font-size: 12px;
            opacity: 0;
            transition: opacity 0.2s;
        }
        
        .key-value-table td:hover::after {
            opacity: 1;
        }
        
        .key-value-table td.copied {
            background-color: #e6ffe6;
        }
        
        .key-value-table td.copied::after {
            content: "복사됨!";
            color: #4CAF50;
            opacity: 1;
        }
        
        .copy-notice {
            text-align: center;
            margin-bottom: 15px;
            color: #666;
            font-style: italic;
        }

        @media (max-width: 900px) {
            .layout-container {
                flex-direction: column;
            }
            
            .button-group {
                flex-direction: column;
            }
            
            button {
                width: 100%;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>어드민 양식 변환기</h1>
        
        <div class="url-container">
            <select id="usefulUrls" onchange="openSelectedUrl()">
                <option value="">유용한 사이트 목록</option>
                <!-- 사이트 목록은 이곳에 추가됩니다 -->
            </select>
        </div>
        
        <div class="layout-container">
            <!-- 입력 컨테이너 (왼쪽 영역) -->
            <div class="input-column">
                <div class="form-row">
                    <div class="form-group">
                        <label for="telecom">통신사 선택:</label>
                        <select id="telecom" onchange="updateAgencies()">
                            <option value="">통신사를 선택하세요</option>
                            <option value="SK">SK</option>
                            <option value="KT">KT</option>
                            <option value="LG">LG</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="agency">대리점 선택:</label>
                        <div style="display: flex; align-items: center;">
                            <select id="agency" disabled>
                                <option value="">대리점을 선택하세요</option>
                            </select>
                            <button type="button" id="agencyInfoBtn" class="info-button" onclick="showAgencyInfo()" disabled>i</button>
                        </div>
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="deviceSerial">단말기 일련번호:</label>
                        <input type="text" id="deviceSerial" class="form-control" placeholder="단말기 일련번호를 입력하세요">
                    </div>
                    
                    <div class="form-group">
                        <label for="simSerial">유심 일련번호:</label>
                        <input type="text" id="simSerial" class="form-control" placeholder="유심 일련번호를 입력하세요">
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="inputText">원본 텍스트:</label>
                    <textarea id="inputText" class="input-textarea" placeholder="여기에 원본 텍스트를 입력하세요"></textarea>
                </div>
                
                <div class="button-group">
                    <button id="convertBtn" onclick="convertFormat()">변환하기</button>
                    <button id="copyBtn" onclick="copyToClipboard()">결과 복사</button>
                    <button id="clearBtn" onclick="clearAll()">모두 지우기</button>
                </div>
            </div>
            
            <!-- 출력 컨테이너 (오른쪽 영역) -->
            <div class="output-column">
                <div id="outputContainer" style="display: block;">
                    <div id="singleOutputContainer">
                        <div class="form-group">
                            <label for="outputText">변환된 텍스트:</label>
                            <textarea id="outputText" class="output-textarea"></textarea>
                        </div>
                    </div>
                    
                    <div id="splitOutputContainer" style="display: none;">
                    </div>
                    
                    <div id="keyValueTableContainer" style="display: none;">
                    </div>
                </div>
                
                <!-- 양식이 여러개인 경우를 위한 템플릿 -->
                <div id="splitOutputTemplate" style="display: none;">
                    <div class="output-section">
                        <h3>재고요청:</h3>
                        <textarea id="outputText1" class="output-textarea"></textarea>
                    </div>
                    <div class="output-section">
                        <h3>개통요청:</h3>
                        <textarea id="outputText2" class="output-textarea"></textarea>
                    </div>
                </div>
                
                <!-- 키-값 테이블 템플릿 -->
                <div id="keyValueTableTemplate" style="display: none;">
                    <div class="copy-notice">각 항목을 클릭하면 해당 값이 클립보드에 복사됩니다.</div>
                    <table class="key-value-table" id="keyValueTable">
                        <tbody>
                            <!-- 키-값 행이 여기에 추가됩니다 -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
    
    <!-- 대리점 메모 팝업 -->
    <div id="memoPopup" class="popup-overlay">
        <div class="popup-content">
            <span class="popup-close" onclick="closeAgencyInfo()">&times;</span>
            <h3 class="popup-title" id="popupTitle">대리점 업무 메모</h3>
            <div class="memo-content" id="memoContent"></div>
        </div>
    </div>
    
    <script>
        // 통신사별 대리점 목록
        const agencies = {
            'SK': ['큐브', '럭스', '나텔', '밀리언', '드블랙', '카파', '장천', '삼보/엠디도매', '코웨어'],
            'KT': ['오앤티', '재희', '안산/이스턴'],
            'LG': ['소리', '제이/휴넷']
        };
        
        // 대리점별 업무 메모
        const agencyMemos = {
            'SK': {
                '큐브': `[큐브 업무 메모]
어드민대리점설정 : SK큐브
■ SK3번 추천인코드				
- 100201 입력 필수				
신조 및 개통 요청 이전에 추천인코드 필수 입력 !!!!!

■ 업무 흐름 ■    
접수확인->신조->배정요청					
개통요청시 개통 메모 신청내역에 일련+유심 기재후					
스윙전송

■ 티게이트 신조 요청시 ■

지점_접수완료 -탭 변경				
신용 이상 없을시 - 접수완료				
신용 이상 있을시 - 배송보류				
**간혹 접수완료여도 신조정상이 아닌경우가 있음				

■ 큐브 주소 ■
경기도 고양시 일산동구 중앙로1261번길 77 한신메트로폴리스 702호	/ 010-7591-0800			`,

                '럭스': `[럭스 업무 메모]
1. 개통 요청 마감: 평일 17:30, 토요일 12:30
2. 유심 발송 요청은 별도 양식으로 전달
3. 전환지원금 신청 시 이전 통신사 가입 증빙 필요
4. 프로모션 코드: SK-LUX-2025
5. 문의 연락처: 02-234-5678 (담당자: 이럭스)
6. 특이사항: 프리미엄 요금제 가입 시 추가 사은품 제공`,

                '나텔': `[나텔 업무 메모]
1. 개통 요청 마감: 평일 17:30, 토요일 12:30
2. 택배 발송 시간: 오전 11시, 오후 3시 (하루 2회)
3. 유심 발송 요청은 별도 양식으로 전달
4. 전환지원금 신청 시 이전 통신사 가입 증빙 필요
5. 문의 연락처: 02-234-5678 (담당자: 박나텔)
6. 특이사항: 택배 요청 시 주소 정확히 기재 필수`,

                '밀리언': `[밀리언 업무 메모]
1. 사이트 ID/PW
    ID:raon010
    PW:1124
    2차 PW:2023
2. ★우체국택배 / 택배마감 4시							
    ★조회및 개통 요청 가능시간 : 5시 30분까지			
    *밀리언주소:송파구 백제고분로 19길 3, HC빌딩 2층 밀레니엄통신/ 070-7455-6672
3. 특별 할인: 선택약정 25% + 추가 5% (조건부)
4. 문의 연락처: 02-345-6789 (담당자: 이밀리언)
5. 특이사항: 프리미엄 요금제 가입 시 추가 혜택 제공`,

                '드블랙': `[드블랙 업무 메모]
★MNO 개통지연있음★					
★개통후 우주패스 별도 요청★					
☆그외 필요 메모는 카톡방 톡게시판에 등록 되있음					
					
**드블랙 주소 :서울시 강남구 신사동 590-9 삼륭빌딩 5층					
박지성 / 010-6234-4450 / 한우석 010-3851-5874`,

                '카파': `[카파 업무 메모]
1. 개통 요청 시간: 평일 9:00 ~ 17:30
2. 단말기 배송: 익일 배송 (오후 3시 이전 주문 건)
3. 프로모션 코드: SK-KAP-2025
4. 문의 연락처: 02-567-8901 (담당자: 정카파)
5. 특이사항: 법인 고객 전용 할인 프로그램 운영 중`,

                '장천': `[장천 업무 메모]
1. 개통 요청 마감: 평일 17:00
2. 단말기 재고 문의: 카카오톡 채널 @장천모바일
3. 프로모션 코드: SK-JC-2025
4. 문의 연락처: 02-678-9012 (담당자: 한장천)
5. 특이사항: 지방 배송 시 추가 1일 소요`,

                '삼보/엠디도매': `[삼보/엠디도매 업무 메모]
1. 개통 요청 시간: 평일 9:00 ~ 18:00
2. 대량 주문(10대 이상) 시 사전 연락 필수
3. 프로모션 코드: SK-SMD-2025
4. 문의 연락처: 02-789-0123 (담당자: 강삼보)
5. 특이사항: B2B 전용 할인 프로그램 운영 중`,
                
                '코웨어': `[코웨어 업무 메모]
어드민 대리점 설정 : SK 코웨어(장용범사장)

티게이트 아이디비번		
ES0029		
dodam8989!

**티게이트 개통메모 넣고 스윙전송 해야함 **

★개통기준정책 ★

티게이트 접수건은 개통처에서 신조 해줌 // 티게이트 메모 보면 알수 있음

우주패스링크				
https://tworldfriends.co.kr/D009890000/sktuniverse/NM00000179`
            },
            'KT': {
                '오앤티': `[오앤티 업무 메모]
1. 개통 요청 마감: 평일 17:30
2. 단말기 배송: 당일 배송 (정오 이전 주문 건)
3. 프로모션 코드: KT-ONT-2025
4. 문의 연락처: 02-890-1234 (담당자: 오앤티)
5. 특이사항: KT 프리미엄 요금제 가입 시 추가 할인`,

                '재희': `[재희 업무 메모]
1. 개통 요청 시간: 평일 9:00 ~ 18:30
2. 단말기 재고 확인: 홈페이지에서 실시간 확인 가능
3. 프로모션 코드: KT-JH-2025
4. 문의 연락처: 02-901-2345 (담당자: 김재희)
5. 특이사항: 5월 프로모션 - 아이폰 시리즈 특별 할인`,

                '안산/이스턴': `[안산/이스턴 업무 메모]
1. 개통 요청 마감: 평일 17:00
2. 단말기 배송: 수도권 지역 당일 배송 가능
3. 프로모션 코드: KT-AS-2025
4. 문의 연락처: 02-012-3456 (담당자: 이안산)
5. 특이사항: 기업 고객 전용 상담 채널 운영 중`
            },
            'LG': {
                '소리': `[소리 업무 메모]
1. 개통 요청 시간: 평일 9:00 ~ 19:00
2. 단말기 배송: 전국 익일 배송
3. 프로모션 코드: LG-SR-2025
4. 문의 연락처: 02-123-4567 (담당자: 박소리)
5. 특이사항: LG 전용 요금제 가입 시 추가 혜택`,

                '제이/휴넷': `[제이/휴넷 업무 메모]
1. 개통 요청 마감: 평일 18:00
2. 단말기 재고 확인: 오전 9시, 오후 2시 업데이트
3. 프로모션 코드: LG-JH-2025
4. 문의 연락처: 02-234-5678 (담당자: 최제이)
5. 특이사항: 선택약정 25% 가입 시 추가 사은품 제공`
            }
        };

        // 대리점별 양식 템플릿
        const templates = {
            'SK': {
                '큐브': (info) => {
                    // 이름 처리
                    const name = info['가입자명'] || info['고객명'] || '';
                    // 연락처 처리
                    const contact = info['개통번호'] || info['전화번호'] || '';
                    // 주소 처리
                    const address = info['택배주소'] || info['배송주소지'] || '';
                    // 통신사/인증 처리
                    const telecom = info['현재통신사'] || '';
                    // 할부원금 처리
                    let paymentInfo = '';
                    if (info['할부현금여부'] === '현금') {
                        paymentInfo = '★현금완납';
                    } else {
                        paymentInfo = info['할부현금여부'] + ' ' + info['최종구매가'] + '원';
                    }
                    
                    // 재고요청 양식
                    const stockRequest = `★재고요청(SK3)
택배or퀵 :	
이름:	${name}
연락처 :	${contact}
주소 :	${address}
유심 :	${info['유심'] || ''}
모델명 :	${info['모델명'] || ''}
색상 :	${info['색상'] || ''}`;
                    
                    // 개통요청 양식
                    const openRequest = `■SK3 개통요청		
◎ 고객명 / 번호 :	${name} / ${contact}	
◎ 주민번호 :	${info['주민번호'] || info['생년월일'] || ''}	
◎ 통신사/인증 :	${telecom}	
◎ 모델/색상 :	${info['모델명'] || ''} / ${info['색상'] || ''}	
◎ 일련번호 :	${info['단말기일련번호'] || ''}	
◎ 유심 일련번호 :	${info['유심일련번호'] || ''}	
◎ 유심비용:	${info['유심'] || ''}	
◎ 요금제 / 혜택 :	${info['요금제'] || ''}	
◎ 공시지원금 :	${info['공시'] || '0'}	
◎ 추지(15%) :	${info['추지'] || '0'}	${info['전환지원금'] && info['전환지원금'] !== '0' ? `
◎ 전환지원금 :	${info['전환지원금']}	` : ''}
◎ 고객선납 :	${info['프리할부'] || '0'}	
◎ 할부원금 : ${paymentInfo}		
◎ 약정유형 :	${info['공시선약여부'] || ''} ${info['약정개월수'] || ''}	
◎ 부가서비스 :	${info['부가서비스'] || ''}`;
                    
                    return { stockRequest, openRequest };
                },
                '럭스': (info) => {
                    // 기본 정보 처리
                    const name = info['가입자명'] || info['고객명'] || '';
                    const contact = info['개통번호'] || info['전화번호'] || '';
                    const modelColor = `${info['모델명'] || ''} / ${info['색상'] || ''}`;
                    const plan = info['요금제'] || '';
                    const subscriptionType = info['가입유형'] || '';
                    
                    // 공시선약여부와 할부현금여부에 따른 양식 분류
                    let template = '';
                    
                    // 공시지원 + 현금
                    if (info['공시선약여부'] === '공시지원' && info['할부현금여부'] === '현금') {
                        template = `판매점명 :	 에이치엘
고객명 :	${name}	
개통번호 :	${contact}	
모델명 / 색상 :	${modelColor}	
유심 일련번호 :	${info['유심일련번호'] || ''}	
요금제명(혜택) :	${plan}	
개통유형 :	${subscriptionType}	
공시 ${info['약정개월수'] || '24개월'}		
현금완납		
		
출고가 ${info['출고가'] || ''}
공시지원 ${info['공시'] || ''}
추가지원 ${info['추지'] || ''}${info['전환지원금'] && info['전환지원금'] !== '0' ? `
전환지원금 ${info['전환지원금']}` : ''}
최종구매가 ${info['최종구매가'] || ''}
		
보험 / 부가서비스 : ${info['부가서비스'] || ''}`;
                    }
                    // 공시지원 + 할부
                    else if (info['공시선약여부'] === '공시지원' && info['할부현금여부'] === '할부') {
                        template = `판매점명 :	 에이치엘
고객명 :	${name}	
개통번호 :	${contact}	
모델명 / 색상 :	${modelColor}	
유심 일련번호 :	${info['유심일련번호'] || ''}	
요금제명(혜택) :	${plan}	
개통유형 :	${subscriptionType}	
공시 ${info['약정개월수'] || '24개월'}		
할부 ${info['할부개월수'] || '24개월'}		
		
출고가 ${info['출고가'] || ''}
공시지원 ${info['공시'] || ''}
추가지원 ${info['추지'] || ''}${info['전환지원금'] && info['전환지원금'] !== '0' ? `
전환지원금 ${info['전환지원금']}` : ''}
프리할부 ${info['프리할부'] || ''}
최종구매가 ${info['최종구매가'] || ''}
		
보험 / 부가서비스 : ${info['부가서비스'] || ''}`;
                    }
                    // 선택약정 + 현금
                    else if ((info['공시선약여부'] === '선택약정' || info['공시선약여부'] === '선약') && info['할부현금여부'] === '현금') {
                        template = `판매점명 :	 에이치엘
고객명 :	${name}	
개통번호 :	${contact}	
모델명 / 색상 :	${modelColor}	
유심 일련번호 :	${info['유심일련번호'] || ''}	
요금제명(혜택) :	${plan}	
개통유형 :	${subscriptionType}	
선약 ${info['약정개월수'] || '24개월'}		
현금완납		
		
출고가 ${info['출고가'] || ''}${info['전환지원금'] && info['전환지원금'] !== '0' ? `
전환지원금 ${info['전환지원금']}` : ''}
최종구매가 ${info['최종구매가'] || ''}
		
보험 / 부가서비스 : ${info['부가서비스'] || ''}`;
                    }
                    // 선택약정 + 할부
                    else if ((info['공시선약여부'] === '선택약정' || info['공시선약여부'] === '선약') && info['할부현금여부'] === '할부') {
                        template = `판매점명 :	 에이치엘
고객명 :	${name}	
개통번호 :	${contact}	
모델명 / 색상 :	${modelColor}	
유심 일련번호 :	${info['유심일련번호'] || ''}	
요금제명(혜택) :	${plan}	
개통유형 :	${subscriptionType}	
선약 ${info['약정개월수'] || '24개월'}		
할부 ${info['할부개월수'] || '24개월'}		
		
출고가 ${info['출고가'] || ''}${info['전환지원금'] && info['전환지원금'] !== '0' ? `
전환지원금 ${info['전환지원금']}` : ''}
프리할부 ${info['프리할부'] || ''}
최종구매가 ${info['최종구매가'] || ''}
		
보험 / 부가서비스 : ${info['부가서비스'] || ''}`;
                    }
                    // 기본 형태 (위 조건에 해당되지 않는 경우)
                    else {
                        template = `[럭스] ${name}님 / ${info['모델명'] || ''} / ${info['색상'] || ''} / ${plan} / ${subscriptionType} / ${info['할부현금여부'] || ''} ${info['최종구매가'] || ''}`;
                    }
                    
                    return template;
                },
                '나텔': (info) => {
                    // 기본 정보 처리
                    const naName = info['가입자명'] || info['고객명'] || '';
                    const naContact = info['개통번호'] || info['전화번호'] || '';
                    const naAddress = info['택배주소'] || info['배송주소지'] || '';
                    const naModel = info['모델명'] || '';
                    const naColor = info['색상'] || '';
                    const naPlan = info['요금제'] || '';
                    const naSubscriptionType = info['가입유형'] || '';
                    const naTelecom = info['현재통신사'] || '';
                    const naAuth = info['인증방법'] || '';
                    
                    // 할부 정보 처리
                    let naPaymentInfo = info['할부현금여부'] || '';
                    if (naPaymentInfo === '할부' && info['할부개월수']) {
                        naPaymentInfo += info['할부개월수'];
                    }
                    
                    // 배송요청 양식 (첫 번째 textarea)
                    const naStockRequest = `택배요청	
	
주소 :	${naAddress}
수취인 :	${naName}
연락처 :	${naContact}
기종/색상:	${naModel} / ${naColor}
유심 :	${info['유심일련번호'] || ''}`;
                    
                    // 개통요청 양식 (두 번째 textarea)
                    // 약정 정보 처리 (공시지원 또는 선택약정 + 개월수)
                    let contractInfo = '';
                    if (info['공시선약여부'] === '공시지원') {
                        contractInfo = `공시지원 ${info['약정개월수'] || '24개월'}`;
                    } else if (info['공시선약여부'] === '선택약정' || info['공시선약여부'] === '선약') {
                        contractInfo = `선택약정 ${info['약정개월수'] || '24개월'}`;
                    } else {
                        contractInfo = `약정없음`;
                    }
                    
                    // 선납 정보 처리 (프리할부 있으면 기재, 없으면 0)
                    const prepayInfo = info['프리할부'] && info['프리할부'] !== '0' ? info['프리할부'] : '0';
                    
                    // 원금 정보 처리 (할부면 최종구매가, 현금이면 0(현금완납))
                    const principalInfo = info['할부현금여부'] === '할부' ? info['최종구매가'] || '0' : '0(현금완납)';
                    
                    // 개월 정보 처리 (할부면 할부개월수, 현금이면 0)
                    const monthsInfo = info['할부현금여부'] === '할부' ? info['할부개월수'] || '24개월' : '0';
                    
                    // 생년월일 또는 주민번호 처리
                    const birthOrRegNum = info['생년월일'] || info['주민번호'] || '';
                    
                    const naOpenRequest = `개통요청 / 전문화	
유형: ${naSubscriptionType}
고객명 :	${naName}
생년월일 :	${birthOrRegNum}
번호 :	${naContact}
기종/색상 :	${naModel} / ${naColor}
일련번호 :	${info['단말기일련번호'] || ''}
유심 :	${info['유심일련번호'] || ''}
요금제 :	${naPlan}
약정 :	${contractInfo}
선납 :	${prepayInfo}
원금 : ${principalInfo}	
개월 :	${monthsInfo}
부가 :	${info['부가서비스'] || ''}
보험 :	`;
                    
                    return { naStockRequest, naOpenRequest };
                },
                '밀리언': (info) => `[밀리언]\n고객명: ${info.고객명}\n모델: ${info.모델명}\n색상: ${info.색상}\n요금제: ${info.요금제}\n가입유형: ${info.가입유형}\n${info.할부현금여부}: ${info.최종구매가}원`,
                '드블랙': (info) => `[드블랙] ${info.고객명} / ${info.모델명} / ${info.색상} / ${info.요금제} / ${info.가입유형} / ${info.할부현금여부} ${info.최종구매가}원`,
                '카파': (info) => `[카파]\n고객: ${info.고객명}\n기기: ${info.모델명} ${info.색상}\n요금: ${info.요금제}\n유형: ${info.가입유형}\n금액: ${info.할부현금여부} ${info.최종구매가}원`,
                '장천': (info) => `[장천] ${info.고객명} - ${info.모델명} ${info.색상} - ${info.요금제} - ${info.가입유형} - ${info.할부현금여부} ${info.최종구매가}원`,
                '삼보/엠디도매': (info) => `[삼보/엠디도매]\n${info.고객명}\n${info.모델명}\n${info.색상}\n${info.요금제}\n${info.가입유형}\n${info.할부현금여부} ${info.최종구매가}원`,
                '코웨어': (info) => {
                    // 기본 정보 처리
                    const name = info['고객명'] || '';
                    const regNum = info['주민번호'] || info['생년월일'] || '';
                    const contact = info['전화번호'] || info['개통번호'] || info['연락처'] || ''; // 전화번호나 개통번호 우선 사용
                    const modelInfo = `${info['모델명'] || ''} ${info['색상'] || ''}`;
                    const serialNum = info['단말기일련번호'] || '';
                    const plan = info['요금제'] || '';
                    
                    // 할부 정보 처리
                    let installment = '';
                    if (info['할부현금여부'] === '할부') {
                        installment = `${info['할부개월수'] || '24개월'}`;
                    } else if (info['할부현금여부'] === '현금') {
                        installment = '0'; // 현금인 경우 0으로 표시
                    }
                    
                    // 프리할부 정보
                    const prepay = info['프리할부'] || '0';
                    
                    // 할부원금 정보
                    let principal = '0';
                    if (info['할부현금여부'] === '할부') {
                        principal = info['최종구매가'] || '0'; // 할부인 경우에만 최종구매가 표시
                    }
                    
                    // 현금완납 정보
                    const cashPayment = info['할부현금여부'] === '현금' ? 'O' : '';
                    
                    // 선약 & 공시 정보
                    let contractType = '';
                    if (info['공시선약여부'] === '공시지원') {
                        contractType = `공시 ${info['약정개월수'] || '24개월'}`;
                    } else if (info['공시선약여부'] === '선택약정' || info['공시선약여부'] === '선약') {
                        contractType = `선약 ${info['약정개월수'] || '24개월'}`;
                    }
                    
                    // 유심 정보
                    const usim = info['유심일련번호'] || info['유심'] || '';
                    
                    // 부가서비스 정보
                    const addon = info['부가서비스'] || '';
                    
                    // 보험가입여부 정보
                    const insurance = info['보험'] || '';
                    
                    // 코웨어 양식
                    return `* 개통요청	
고객명 - ${name}	
주민번호 - ${regNum}	
개통번호 - ${contact}	
단말정보 - ${modelInfo}	
일련번호 - ${serialNum}	
요금제 - ${plan}	
할부 - ${installment}	
프리 - ${prepay}	
할부원금 - ${principal}	
현금완납 - ${cashPayment}	
선약&공시 - ${contractType}	
유심 - ${usim}	
부가 - ${addon}	
보험가입여부 - ${insurance}`;
                }
            },
            'KT': {
                '오앤티': (info) => `[오앤티] ${info.고객명} / ${info.모델명} ${info.색상} / ${info.요금제} / ${info.가입유형} / ${info.할부현금여부} ${info.최종구매가}원`,
                '재희': (info) => `[재희] ${info.고객명} / ${info.모델명} ${info.색상} / ${info.요금제} / ${info.가입유형} / ${info.할부현금여부} ${info.최종구매가}원`,
                '안산/이스턴': (info) => `[안산/이스턴] ${info.고객명} - ${info.모델명} - ${info.색상} - ${info.요금제} - ${info.가입유형} - ${info.할부현금여부} ${info.최종구매가}원`
            },
            'LG': {
                '소리': (info) => `[소리] ${info.고객명} / ${info.모델명} / ${info.색상} / ${info.요금제} / ${info.가입유형} / ${info.할부현금여부} ${info.최종구매가}원`,
                '제이/휴넷': (info) => `[제이/휴넷]\n고객: ${info.고객명}\n모델: ${info.모델명}\n색상: ${info.색상}\n요금제: ${info.요금제}\n가입유형: ${info.가입유형}\n${info.할부현금여부}: ${info.최종구매가}원`
            }
        };

        // 통신사 선택에 따라 대리점 목록 업데이트
        function updateAgencies() {
            const telecomSelect = document.getElementById('telecom');
            const agencySelect = document.getElementById('agency');
            const agencyInfoBtn = document.getElementById('agencyInfoBtn');
            
            // 대리점 선택 초기화
            agencySelect.innerHTML = '<option value="">대리점을 선택하세요</option>';
            agencySelect.disabled = true;
            agencyInfoBtn.disabled = true;
            
            const selectedTelecom = telecomSelect.value;
            
            if (selectedTelecom) {
                // 선택된 통신사에 해당하는 대리점 목록 추가
                agencies[selectedTelecom].forEach(agency => {
                    const option = document.createElement('option');
                    option.value = agency;
                    option.textContent = agency;
                    agencySelect.appendChild(option);
                });
                
                // 대리점 선택 활성화
                agencySelect.disabled = false;
                agencyInfoBtn.disabled = false;
            }
        }

        // 텍스트에서 고객 정보 추출
        function extractCustomerInfo(text) {
            const customerInfo = {};
            
            // 정규식 패턴으로 각 항목 추출
            const patterns = {
                '전화번호': /\*\*전화번호\s*-\s*([^\n]+)/,
                '개통번호': /\*\*개통번호\s*-\s*([^\n]+)/,
                '모델명': /\*\*모델명\s*-\s*([^\n]+)/,
                '색상': /\*\*색상\s*-\s*([^\n]+)/,
                '고객명': /\*\*고객명\s*-\s*([^\n]+)/,
                '가입자명': /\*\*가입자명\s*-\s*([^\n]+)/,
                '주민번호': /\*\*주민번호\s*-\s*([^\n]+)/,
                '생년월일': /\*\*생년월일\s*-\s*([^\n]+)/,
                '택배주소': /\*\*택배주소\s*-\s*([^\n]+)/,
                '배송주소지': /\*\*배송주소지\s*-\s*([^\n]+)/,
                '현재통신사': /\*\*현재통신사\s*-\s*([^\n]+)/,
                '요금제': /\*\*요금제\s*-\s*([^\n]+)/,
                '가입유형': /\*\*가입유형\s*-\s*([^\n]+)/,
                '할인유형': /\*\*할인유형\s*-\s*([^\n]+)/,
                '유심': /\*\*유심\s*-\s*([^\n]+)/,
                '부가서비스': /\*\*부가서비스\s*-\s*([^\n]+)/
            };
            
            // 각 패턴에 맞게 정보 추출
            for (const [key, pattern] of Object.entries(patterns)) {
                const match = text.match(pattern);
                if (match && match[1]) {
                    customerInfo[key] = match[1].trim();
                } else {
                    customerInfo[key] = '';
                }
            }
            
            // 개통번호와 전화번호 통합 처리 (전화번호가 없을 경우 개통번호 사용)
            if (!customerInfo['전화번호'] && customerInfo['개통번호']) {
                customerInfo['전화번호'] = customerInfo['개통번호'];
            }
            
            // 고객명과 가입자명 통합 처리 (고객명이 없을 경우 가입자명 사용)
            if (!customerInfo['고객명'] && customerInfo['가입자명']) {
                customerInfo['고객명'] = customerInfo['가입자명'];
            }
            
            // 주민번호와 생년월일 통합 처리 (주민번호가 없을 경우 생년월일 사용)
            if (!customerInfo['주민번호'] && customerInfo['생년월일']) {
                customerInfo['주민번호'] = customerInfo['생년월일'];
            }
            
            // 택배주소와 배송주소지 통합 처리 (택배주소가 없을 경우 배송주소지 사용)
            if (!customerInfo['택배주소'] && customerInfo['배송주소지']) {
                customerInfo['택배주소'] = customerInfo['배송주소지'];
            }
            
            // 가입유형에서 공시선약여부와 약정개월수 추출
            if (customerInfo['가입유형']) {
                // 공시지원 여부 추출
                if (customerInfo['가입유형'].includes('공시지원')) {
                    customerInfo['공시선약여부'] = '공시지원';
                } else if (customerInfo['가입유형'].includes('선택약정')) {
                    customerInfo['공시선약여부'] = '선택약정';
                } else if (customerInfo['가입유형'].includes('선약')) {
                    customerInfo['공시선약여부'] = '선약';
                } else {
                    customerInfo['공시선약여부'] = '';
                }
                
                // 약정 개월수 추출
                const monthMatch = customerInfo['가입유형'].match(/(\d+)\s*개월/);
                if (monthMatch && monthMatch[1]) {
                    customerInfo['약정개월수'] = monthMatch[1] + '개월';
                } else {
                    customerInfo['약정개월수'] = '';
                }
            } else {
                customerInfo['공시선약여부'] = '';
                customerInfo['약정개월수'] = '';
            }
            
            // 할인유형에서 공시선약여부와 약정개월수 추출
            if (customerInfo['할인유형']) {
                // 공시지원 여부 추출
                if (customerInfo['할인유형'].includes('공시지원')) {
                    customerInfo['공시선약여부'] = '공시지원';
                } else if (customerInfo['할인유형'].includes('선택약정')) {
                    customerInfo['공시선약여부'] = '선택약정';
                } else if (customerInfo['할인유형'].includes('선약')) {
                    customerInfo['공시선약여부'] = '선약';
                }
                
                // 약정 개월수 추출
                const monthMatch = customerInfo['할인유형'].match(/(\d+)\s*개월/);
                if (monthMatch && monthMatch[1]) {
                    customerInfo['약정개월수'] = monthMatch[1] + '개월';
                }
            }
            
            // 출고가, 공시, 추지, 전환지원금, 프리할부, 할부/현금 정보 추출
            // 전환지원금이 포함된 패턴
            const conversionPattern = /\*\*출고가\s+([\d,]+)\s*-\s*공시\s+([\d,]+)\s*-\s*추지\s+([\d,]+)\s*-\s*(전환지원금?|전환)\s+([\d,]+)(?:\s*-\s*프리할부\s+([\d,]+))?\s*=\s*(할부\d+|\ud604\uae08)\s*([\d,]+)/;
            const conversionMatch = text.match(conversionPattern);
            
            if (conversionMatch) {
                customerInfo['출고가'] = conversionMatch[1].trim();
                customerInfo['공시'] = conversionMatch[2].trim();
                customerInfo['추지'] = conversionMatch[3].trim();
                customerInfo['전환지원금'] = conversionMatch[5].trim();
                customerInfo['프리할부'] = conversionMatch[6] ? conversionMatch[6].trim() : '0';
                
                // 할부/현금 여부 확인
                if (conversionMatch[7].includes('할부')) {
                    customerInfo['할부현금여부'] = '할부';
                    
                    // 할부개월수 추출
                    const installmentMatch = conversionMatch[7].match(/(\d+)/);
                    if (installmentMatch && installmentMatch[1]) {
                        customerInfo['할부개월수'] = installmentMatch[1] + '개월';
                    } else {
                        customerInfo['할부개월수'] = '24개월'; // 기본값
                    }
                } else {
                    customerInfo['할부현금여부'] = '현금';
                    customerInfo['할부개월수'] = '';
                }
                
                customerInfo['최종구매가'] = conversionMatch[8].trim();
            } else {
                // 기존 패턴 (전환지원금 없는 경우)
                const pricePattern = /\*\*출고가\s+([\d,]+)\s*-\s*공시\s+([\d,]+)\s*-\s*추지\s+([\d,]+)(?:\s*-\s*프리할부\s+([\d,]+))?\s*=\s*(할부\d+|\ud604\uae08)\s*([\d,]+)/;
                const priceMatch = text.match(pricePattern);
                
                if (priceMatch) {
                    customerInfo['출고가'] = priceMatch[1].trim();
                    customerInfo['공시'] = priceMatch[2].trim();
                    customerInfo['추지'] = priceMatch[3].trim();
                    customerInfo['전환지원금'] = '0';
                    customerInfo['프리할부'] = priceMatch[4] ? priceMatch[4].trim() : '0';
                    
                    // 할부/현금 여부 확인
                    if (priceMatch[5].includes('할부')) {
                        customerInfo['할부현금여부'] = '할부';
                        
                        // 할부개월수 추출
                        const installmentMatch = priceMatch[5].match(/(\d+)/);
                        if (installmentMatch && installmentMatch[1]) {
                            customerInfo['할부개월수'] = installmentMatch[1] + '개월';
                        } else {
                            customerInfo['할부개월수'] = '24개월'; // 기본값
                        }
                    } else {
                        customerInfo['할부현금여부'] = '현금';
                        customerInfo['할부개월수'] = '';
                    }
                    
                    customerInfo['최종구매가'] = priceMatch[6].trim();
                } else {
                    // 현금 형식 패턴 확인 (전환지원금 포함)
                    const cashConversionPattern = /\*\*출고가\s+([\d,]+)\s*-\s*공시\s+([\d,]+)\s*-\s*추지\s+([\d,]+)\s*-\s*(전환지원금?|전환)\s+([\d,]+)(?:\s*-\s*프리할부\s+([\d,]+))?\s*=\s*현금\s*([\d,]+)/;
                    const cashConversionMatch = text.match(cashConversionPattern);
                    
                    if (cashConversionMatch) {
                        customerInfo['출고가'] = cashConversionMatch[1].trim();
                        customerInfo['공시'] = cashConversionMatch[2].trim();
                        customerInfo['추지'] = cashConversionMatch[3].trim();
                        customerInfo['전환지원금'] = cashConversionMatch[5].trim();
                        customerInfo['프리할부'] = cashConversionMatch[6] ? cashConversionMatch[6].trim() : '0';
                        customerInfo['할부현금여부'] = '현금';
                        customerInfo['할부개월수'] = '';
                        customerInfo['최종구매가'] = cashConversionMatch[7].trim();
                    } else {
                        // 기존 현금 형식 패턴 (전환지원금 없는 경우)
                        const cashPattern = /\*\*출고가\s+([\d,]+)\s*-\s*공시\s+([\d,]+)\s*-\s*추지\s+([\d,]+)(?:\s*-\s*프리할부\s+([\d,]+))?\s*=\s*현금\s*([\d,]+)/;
                        const cashMatch = text.match(cashPattern);
                        
                        if (cashMatch) {
                            customerInfo['출고가'] = cashMatch[1].trim();
                            customerInfo['공시'] = cashMatch[2].trim();
                            customerInfo['추지'] = cashMatch[3].trim();
                            customerInfo['전환지원금'] = '0';
                            customerInfo['프리할부'] = cashMatch[4] ? cashMatch[4].trim() : '0';
                            customerInfo['할부현금여부'] = '현금';
                            customerInfo['할부개월수'] = '';
                            customerInfo['최종구매가'] = cashMatch[5].trim();
                        } else {
                            // 할부 형식 패턴 확인 (전환지원금 포함)
                            const installmentConversionPattern = /\*\*출고가\s+([\d,]+)\s*-\s*공시\s+([\d,]+)\s*-\s*추지\s+([\d,]+)\s*-\s*(전환지원금?|전환)\s+([\d,]+)(?:\s*-\s*프리할부\s+([\d,]+))?\s*=\s*할부(\d+)\s*([\d,]+)/;
                            const installmentConversionMatch = text.match(installmentConversionPattern);
                            
                            if (installmentConversionMatch) {
                                customerInfo['출고가'] = installmentConversionMatch[1].trim();
                                customerInfo['공시'] = installmentConversionMatch[2].trim();
                                customerInfo['추지'] = installmentConversionMatch[3].trim();
                                customerInfo['전환지원금'] = installmentConversionMatch[5].trim();
                                customerInfo['프리할부'] = installmentConversionMatch[6] ? installmentConversionMatch[6].trim() : '0';
                                customerInfo['할부현금여부'] = '할부';
                                customerInfo['할부개월수'] = installmentConversionMatch[7] + '개월';
                                customerInfo['최종구매가'] = installmentConversionMatch[8].trim();
                            } else {
                                // 기존 할부 형식 패턴 (전환지원금 없는 경우)
                                const alternatePattern = /\*\*출고가\s+([\d,]+)\s*-\s*공시\s+([\d,]+)\s*-\s*추지\s+([\d,]+)(?:\s*-\s*프리할부\s+([\d,]+))?\s*=\s*할부(\d+)\s*([\d,]+)/;
                                const alternateMatch = text.match(alternatePattern);
                                
                                if (alternateMatch) {
                                    customerInfo['출고가'] = alternateMatch[1].trim();
                                    customerInfo['공시'] = alternateMatch[2].trim();
                                    customerInfo['추지'] = alternateMatch[3].trim();
                                    customerInfo['전환지원금'] = '0';
                                    customerInfo['프리할부'] = alternateMatch[4] ? alternateMatch[4].trim() : '0';
                                    customerInfo['할부현금여부'] = '할부';
                                    customerInfo['할부개월수'] = alternateMatch[5] + '개월';
                                    customerInfo['최종구매가'] = alternateMatch[6].trim();
                                } else {
                                    customerInfo['출고가'] = '';
                                    customerInfo['공시'] = '';
                                    customerInfo['추지'] = '';
                                    customerInfo['전환지원금'] = '0';
                                    customerInfo['프리할부'] = '0';
                                    customerInfo['할부현금여부'] = '';
                                    customerInfo['할부개월수'] = '';
                                    customerInfo['최종구매가'] = '';
                                }
                            }
                        }
                    }
                }
            }
            
            return customerInfo;
        }

        // 양식 변환 함수
        function convertFormat() {
            const telecomSelect = document.getElementById('telecom');
            const agencySelect = document.getElementById('agency');
            const inputText = document.getElementById('inputText');
            const deviceSerialInput = document.getElementById('deviceSerial');
            const simSerialInput = document.getElementById('simSerial');
            const outputContainer = document.getElementById('outputContainer');
            const singleOutputContainer = document.getElementById('singleOutputContainer');
            const splitOutputContainer = document.getElementById('splitOutputContainer');
            const keyValueTableContainer = document.getElementById('keyValueTableContainer');
            
            const selectedTelecom = telecomSelect.value;
            const selectedAgency = agencySelect.value;
            
            if (!selectedTelecom || !selectedAgency) {
                alert('통신사와 대리점을 모두 선택해주세요.');
                return;
            }
            
            if (!inputText.value.trim()) {
                alert('변환할 텍스트를 입력해주세요.');
                return;
            }
            
            // 고객 정보 추출
            const customerInfo = extractCustomerInfo(inputText.value);
            
            // 단말기 일련번호와 유심 일련번호 추가
            if (deviceSerialInput.value.trim()) {
                customerInfo['단말기일련번호'] = deviceSerialInput.value.trim();
            }
            
            if (simSerialInput.value.trim()) {
                customerInfo['유심일련번호'] = simSerialInput.value.trim();
            }
            
            // 콘솔에 객체 정보 출력 (디버깅용)
            console.log('추출된 고객 정보 객체:', customerInfo);
            console.table(customerInfo); // 테이블 형태로 출력하여 가독성 향상
            
            // 출력 컨테이너 표시
            outputContainer.style.display = 'block';
            
            // 키-값 테이블 사용 여부 확인
            const useKeyValueTable = 
                (selectedTelecom === 'KT' && selectedAgency === '재희') || 
                (selectedTelecom === 'LG' && selectedAgency === '소리');
            
            // 선택된 대리점에 맞는 템플릿으로 변환
            try {
                // 키-값 테이블 형식 사용
                if (useKeyValueTable) {
                    // 다른 출력 컨테이너 숨기기
                    singleOutputContainer.style.display = 'none';
                    splitOutputContainer.style.display = 'none';
                    
                    // 키-값 테이블 템플릿 복제 및 표시
                    const keyValueTable = document.getElementById('keyValueTableTemplate').cloneNode(true);
                    keyValueTable.id = '';
                    keyValueTable.style.display = 'block';
                    keyValueTableContainer.innerHTML = '';
                    keyValueTableContainer.appendChild(keyValueTable);
                    keyValueTableContainer.style.display = 'block';
                    
                    // 키-값 테이블 생성
                    createKeyValueTable(customerInfo);
                    return;
                }
                
                // 일반 템플릿 사용
                const template = templates[selectedTelecom][selectedAgency];
                if (template) {
                    // 키-값 테이블 컨테이너 숨기기
                    keyValueTableContainer.style.display = 'none';
                    
                    // SK-큐브의 경우 양식이 두개로 분할됨
                    if (selectedTelecom === 'SK' && selectedAgency === '큐브') {
                        const result = template(customerInfo);
                        
                        // 단일 출력 컨테이너 숨기기
                        singleOutputContainer.style.display = 'none';
                        
                        // 분할된 출력을 위한 UI 생성
                        const splitOutput = document.getElementById('splitOutputTemplate').cloneNode(true);
                        splitOutput.id = '';
                        splitOutput.style.display = 'block';
                        splitOutputContainer.innerHTML = '';
                        splitOutputContainer.appendChild(splitOutput);
                        splitOutputContainer.style.display = 'block';
                        
                        // 각 텍스트에리어에 결과 설정
                        splitOutputContainer.querySelector('#outputText1').value = result.stockRequest;
                        splitOutputContainer.querySelector('#outputText2').value = result.openRequest;
                    } else if (selectedTelecom === 'SK' && selectedAgency === '나텔') {
                        // 나텔의 경우도 양식이 두개로 분할됨
                        const result = template(customerInfo);
                        
                        // 단일 출력 컨테이너 숨기기
                        singleOutputContainer.style.display = 'none';
                        
                        // 분할된 출력을 위한 UI 생성
                        const splitOutput = document.getElementById('splitOutputTemplate').cloneNode(true);
                        splitOutput.id = '';
                        splitOutput.style.display = 'block';
                        splitOutputContainer.innerHTML = '';
                        splitOutputContainer.appendChild(splitOutput);
                        splitOutputContainer.style.display = 'block';
                        
                        // 각 텍스트에리어에 결과 설정
                        splitOutputContainer.querySelector('#outputText1').value = result.naStockRequest;
                        splitOutputContainer.querySelector('#outputText2').value = result.naOpenRequest;
                    } else {
                        // 단일 출력 형태
                        splitOutputContainer.style.display = 'none';
                        singleOutputContainer.style.display = 'block';
                        
                        // 결과 설정
                        document.getElementById('outputText').value = template(customerInfo);
                    }
                    
                    // 더블클릭 이벤트 설정
                    setupDoubleClickCopy();
                } else {
                    // 템플릿이 없는 경우
                    keyValueTableContainer.style.display = 'none';
                    splitOutputContainer.style.display = 'none';
                    singleOutputContainer.style.display = 'block';
                    document.getElementById('outputText').value = '선택한 대리점에 대한 템플릿이 없습니다.';
                }
            } catch (error) {
                console.error('변환 중 오류 발생:', error);
                
                // 오류 발생 시 단일 출력 형태
                keyValueTableContainer.style.display = 'none';
                splitOutputContainer.style.display = 'none';
                singleOutputContainer.style.display = 'block';
                document.getElementById('outputText').value = '변환 중 오류가 발생했습니다. 입력 텍스트를 확인해주세요.';
            }
        }
        
        // 키-값 테이블 생성 함수
        function createKeyValueTable(customerInfo) {
            const tableBody = document.querySelector('#keyValueTable tbody');
            tableBody.innerHTML = ''; // 테이블 초기화
            
            // 필드 매핑 정의 (화면에 표시될 이름 -> 객체의 실제 키)
            const fieldMapping = {
                '고객명': '고객명',
                '전화번호': '전화번호',
                '개통번호': '개통번호',
                '모델명': '모델명',
                '색상': '색상',
                '가입유형': '가입유형',
                '할인유형': '할인유형',
                '요금제': '요금제',
                '유심': '유심',
                '부가서비스': '부가서비스',
                '출고가': '출고가',
                '공시지원금': '공시',
                '추가지원금': '추지',
                '전환지원금': '전환지원금',
                '실 구매가': '최종구매가',
                '주민번호': '주민번호',
                '생년월일': '생년월일',
                '택배주소': '택배주소',
                '배송주소지': '배송주소지',
                '현재통신사': '현재통신사',
                '단말기일련번호': '단말기일련번호',
                '유심일련번호': '유심일련번호'
            };
            
            // 표시할 필드 순서 정의
            const fields = [
                '고객명', '전화번호', '개통번호', '모델명', '색상',
                '가입유형', '할인유형', '요금제', '유심', '부가서비스',
                '출고가', '공시지원금', '추가지원금', '전환지원금', '실 구매가', // 추가된 필드
                '주민번호', '생년월일', '택배주소', '배송주소지', '현재통신사',
                '단말기일련번호', '유심일련번호'
            ];
            
            // 필드마다 행 생성
            fields.forEach(displayName => {
                // 매핑된 실제 키 가져오기
                const actualKey = fieldMapping[displayName];
                
                // 기존 필드가 있는 경우
                if (actualKey && customerInfo[actualKey]) {
                    addTableRow(tableBody, displayName, customerInfo[actualKey]);
                } 
                // 전환지원금은 값이 있는 경우에만 표시
                else if (displayName === '전환지원금') {
                    // 값이 있고 0이 아닌 경우에만 표시
                    if (actualKey && customerInfo[actualKey] && 
                        customerInfo[actualKey] !== '0' && 
                        customerInfo[actualKey] !== 0 && 
                        customerInfo[actualKey].toString().trim() !== '') {
                        addTableRow(tableBody, displayName, customerInfo[actualKey]);
                    }
                }
                // 출고가, 공시지원금, 추가지원금, 실 구매가 필드는 없는 경우에도 표시
                else if (displayName === '출고가' || displayName === '공시지원금' || 
                         displayName === '추가지원금' || displayName === '실 구매가') {
                    // 해당 필드가 없는 경우 빈 값으로 표시
                    addTableRow(tableBody, displayName, actualKey && customerInfo[actualKey] ? customerInfo[actualKey] : '');
                }
            });
        }
        
        // 키-값 테이블에 행 추가하는 함수
        function addTableRow(tableBody, key, value) {
            const row = document.createElement('tr');
            
            const keyCell = document.createElement('td');
            keyCell.className = 'key-cell';
            keyCell.textContent = key;
            
            const valueCell = document.createElement('td');
            valueCell.className = 'value-cell';
            valueCell.textContent = value;
            valueCell.setAttribute('data-value', value);
            valueCell.onclick = function() {
                copyToClipboardWithFeedback(this.getAttribute('data-value'), this);
            };
            
            row.appendChild(keyCell);
            row.appendChild(valueCell);
            tableBody.appendChild(row);
        }
        
        // 클립보드에 복사 후 피드백을 제공하는 함수
        function copyToClipboardWithFeedback(text, element) {
            navigator.clipboard.writeText(text).then(() => {
                // 복사 성공 표시
                element.classList.add('copied');
                
                // 1.5초 후 복사 성공 표시 제거
                setTimeout(() => {
                    element.classList.remove('copied');
                }, 1500);
                
                // 화면 중앙에 복사 성공 알림 표시
                const copyNotice = document.createElement('div');
                copyNotice.className = 'copy-success';
                copyNotice.textContent = '복사됨!';
                copyNotice.style.position = 'fixed';
                copyNotice.style.top = '50%';
                copyNotice.style.left = '50%';
                copyNotice.style.transform = 'translate(-50%, -50%)';
                copyNotice.style.backgroundColor = 'rgba(76, 175, 80, 0.9)';
                copyNotice.style.color = 'white';
                copyNotice.style.padding = '10px 20px';
                copyNotice.style.borderRadius = '5px';
                copyNotice.style.zIndex = '2000';
                copyNotice.style.transition = 'opacity 0.3s';
                
                document.body.appendChild(copyNotice);
                
                // 1초 후 알림 페이드아웃
                setTimeout(() => {
                    copyNotice.style.opacity = '0';
                    setTimeout(() => {
                        document.body.removeChild(copyNotice);
                    }, 300);
                }, 1000);
            }).catch(err => {
                console.error('복사 실패:', err);
                alert('복사에 실패했습니다.');
            });
        }

        // 결과 복사 함수
        function copyToClipboard() {
            // 키-값 테이블이 표시되어 있는지 확인
            const keyValueTableContainer = document.getElementById('keyValueTableContainer');
            if (keyValueTableContainer && keyValueTableContainer.style.display !== 'none') {
                alert('키-값 테이블에서는 각 항목을 클릭하여 개별적으로 복사해주세요.');
                return;
            }
            
            // SK-큐브의 경우 여러 텍스트에리어가 있을 수 있음
            const outputText1 = document.getElementById('outputText1');
            const outputText2 = document.getElementById('outputText2');
            const outputText = document.getElementById('outputText');
            
            let textToCopy = '';
            let elementToCopy = null;
            
            if (outputText1 && outputText1.style.display !== 'none' && outputText1.value.trim() !== '') {
                textToCopy = outputText1.value;
                elementToCopy = outputText1;
            } else if (outputText2 && outputText2.style.display !== 'none' && outputText2.value.trim() !== '') {
                textToCopy = outputText2.value;
                elementToCopy = outputText2;
            } else if (outputText && outputText.value.trim() !== '') {
                textToCopy = outputText.value;
                elementToCopy = outputText;
            } else {
                alert('복사할 텍스트가 없습니다.');
                return;
            }
            
            // 클립보드 API를 사용하여 복사
            if (navigator.clipboard && navigator.clipboard.writeText) {
                navigator.clipboard.writeText(textToCopy)
                    .then(() => {
                        // 복사 완료 표시
                        const originalBgColor = elementToCopy.style.backgroundColor;
                        elementToCopy.style.backgroundColor = '#e6ffe6';
                        
                        setTimeout(() => {
                            elementToCopy.style.backgroundColor = originalBgColor;
                        }, 500);
                        
                        // 화면 중앙에 복사 성공 알림 표시
                        const copyNotice = document.createElement('div');
                        copyNotice.className = 'copy-success';
                        copyNotice.textContent = '복사됨!';
                        copyNotice.style.position = 'fixed';
                        copyNotice.style.top = '50%';
                        copyNotice.style.left = '50%';
                        copyNotice.style.transform = 'translate(-50%, -50%)';
                        copyNotice.style.backgroundColor = 'rgba(76, 175, 80, 0.9)';
                        copyNotice.style.color = 'white';
                        copyNotice.style.padding = '10px 20px';
                        copyNotice.style.borderRadius = '5px';
                        copyNotice.style.zIndex = '2000';
                        copyNotice.style.transition = 'opacity 0.3s';
                        
                        document.body.appendChild(copyNotice);
                        
                        // 1초 후 알림 페이드아웃
                        setTimeout(() => {
                            copyNotice.style.opacity = '0';
                            setTimeout(() => {
                                document.body.removeChild(copyNotice);
                            }, 300);
                        }, 1000);
                    })
                    .catch(err => {
                        console.error('복사 실패:', err);
                        alert('복사에 실패했습니다.');
                    });
            } else {
                // 예전 방식 사용 (Clipboard API가 지원되지 않는 경우)
                elementToCopy.select();
                document.execCommand('copy');
                
                // 복사 완료 표시
                const originalBgColor = elementToCopy.style.backgroundColor;
                elementToCopy.style.backgroundColor = '#e6ffe6';
                
                setTimeout(() => {
                    elementToCopy.style.backgroundColor = originalBgColor;
                }, 500);
                
                // 알림 표시
                alert('텍스트가 복사되었습니다.');
            }
        }

        // 텍스트에리어 더블클릭 복사 함수
        function setupDoubleClickCopy() {
            // 출력 컨테이너의 모든 텍스트에리어에 더블클릭 이벤트 추가
            const outputContainer = document.getElementById('outputContainer');
            const textareas = outputContainer.querySelectorAll('textarea');
            
            textareas.forEach(textarea => {
                textarea.removeEventListener('dblclick', handleDoubleClick);
                textarea.addEventListener('dblclick', handleDoubleClick);
            });
        }
        
        // 더블클릭 이벤트 핸들러
        function handleDoubleClick(event) {
            const textarea = event.target;
            
            // 텍스트 선택
            textarea.select();
            
            // 클립보드에 복사
            navigator.clipboard.writeText(textarea.value).then(() => {
                // 복사 성공 시 시각적 피드백
                const originalBgColor = textarea.style.backgroundColor;
                textarea.style.backgroundColor = '#d4edda';
                setTimeout(() => {
                    textarea.style.backgroundColor = originalBgColor;
                }, 500);
            }).catch(err => {
                console.error('클립보드 복사 오류:', err);
                alert('복사 중 오류가 발생했습니다.');
            });
        }
        
        // 모두 지우기 함수
        function clearAll() {
            document.getElementById('telecom').value = '';
            const agencySelect = document.getElementById('agency');
            agencySelect.innerHTML = '<option value="">대리점을 선택하세요</option>';
            agencySelect.disabled = true;
            document.getElementById('deviceSerial').value = '';
            document.getElementById('simSerial').value = '';
            document.getElementById('inputText').value = '';
            
            // 출력 컨테이너 초기화
            const outputContainer = document.getElementById('outputContainer');
            outputContainer.innerHTML = `
                <div class="form-group">
                    <label for="outputText">변환된 텍스트:</label>
                    <textarea id="outputText" class="output-textarea" placeholder="여기에 변환된 결과가 표시됩니다. 더블클릭하면 복사됩니다."></textarea>
                </div>
            `;
            
            // 더블클릭 이벤트 설정
            setupDoubleClickCopy();
        }
        // 대리점 정보 팝업 함수
        function showAgencyInfo() {
            const telecomSelect = document.getElementById('telecom');
            const agencySelect = document.getElementById('agency');
            const selectedTelecom = telecomSelect.value;
            const selectedAgency = agencySelect.value;
            
            if (!selectedTelecom || !selectedAgency) {
                alert('통신사와 대리점을 모두 선택해주세요.');
                return;
            }
            
            const popup = document.getElementById('memoPopup');
            const popupTitle = document.getElementById('popupTitle');
            const popupContent = document.getElementById('memoContent');
            
            // 팝업 제목 설정
            popupTitle.textContent = `${selectedAgency} 업무 메모`;
            
            // 팝업 내용 설정
            if (agencyMemos[selectedTelecom] && agencyMemos[selectedTelecom][selectedAgency]) {
                popupContent.textContent = agencyMemos[selectedTelecom][selectedAgency];
            } else {
                popupContent.textContent = '해당 대리점에 대한 업무 메모가 없습니다.';
            }
            
            // 팝업 표시
            popup.style.display = 'flex';
        }
        
        // 대리점 정보 팝업 닫기 함수
        function closeAgencyInfo() {
            const popup = document.getElementById('memoPopup');
            popup.style.display = 'none';
        }
        
        // ESC 키로 팝업 닫기
        document.addEventListener('keydown', function(event) {
            if (event.key === 'Escape') {
                closeAgencyInfo();
            }
        });
        
        // 팝업 외부 클릭 시 닫기
        document.getElementById('memoPopup').addEventListener('click', function(event) {
            if (event.target === this) {
                closeAgencyInfo();
            }
        });
        
        // 페이지 로드 시 초기화
        // 유용한 URL 사이트 목록
        const usefulSites = [
            { name: 'SK 업무관련', sites: [
                { name: 'SK 티게이트', url: 'https://tgate.sktelecom.com/' },
                { name: 'SK 티게이트 조회', url: 'https://tgateplus.sktelecom.com/scrb/frontList.do' },
                { name: 'GTS', url: 'https://gts.bizmax.net/' },
                { name: '밀리언 접수 사이트', url: 'http://www.inbangpan.co.kr' },
                { name: 'SK 큐브 재고표(SK3 탭 확인)', url: 'https://docs.google.com/spreadsheets/d/1BlrYaOOqMFEb-TLVnvI6KXCjMJvUWT7UipUAUgvqI5g/edit#gid=1994358026' }
            ]},
            { name: '휴대폰 요금관련 정보', sites: [
                { name: '레인보우컨설팅', url: 'https://goodmorningrainbow.com/renew/index.php' }
            ]},
            { name: '요금제 정보', sites: [
                { name: 'SK 요금제', url: 'https://www.tworld.co.kr/normal.do?serviceId=S_PROD2001&viewId=V_PROD2001&prod_id=TW50000001' },
                { name: 'KT 요금제', url: 'https://product.kt.com/wDic/index.do' },
                { name: 'LG U+ 요금제', url: 'https://www.uplus.co.kr/ent/spps/chrg/RetrievePsChrgLstPaging.hpi' }
            ]},
            { name: '유용한 도구', sites: [
                { name: '유심 번호 조회', url: 'https://www.msisdn.kr/' },
                { name: '전화번호 소유자 조회', url: 'https://www.msisdn.kr/search/search.php' },
                { name: '우편번호 조회', url: 'https://www.epost.go.kr/search.RetrieveNewAddressAreaCdList.comm' }
            ]}
        ];
        
        // 선택한 URL 열기 함수
        function openSelectedUrl() {
            const selectBox = document.getElementById('usefulUrls');
            const selectedValue = selectBox.value;
            
            if (selectedValue) {
                window.open(selectedValue, '_blank');
                // 선택박스 초기화
                selectBox.selectedIndex = 0;
            }
        }
        
        document.addEventListener('DOMContentLoaded', function() {
            // 초기 텍스트에리어에 더블클릭 이벤트 설정
            setupDoubleClickCopy();
            
            // 초기화 메시지 추가
            const outputText = document.getElementById('outputText');
            if (outputText) {
                outputText.placeholder = '여기에 변환된 결과가 표시됩니다. 더블클릭하면 복사됩니다.';
                // 클래스 추가
                outputText.classList.add('output-textarea');
            }
            
            // 입력 텍스트에리어에 클래스 추가
            const inputText = document.getElementById('inputText');
            if (inputText) {
                inputText.classList.add('input-textarea');
            }
            
            // 유용한 URL 목록 초기화
            const usefulUrlsSelect = document.getElementById('usefulUrls');
            
            // 그룹별로 사이트 목록 추가
            usefulSites.forEach(group => {
                // 그룹 제목 추가
                const groupOption = document.createElement('optgroup');
                groupOption.label = group.name;
                
                // 그룹 내 사이트 추가
                group.sites.forEach(site => {
                    const option = document.createElement('option');
                    option.value = site.url;
                    option.textContent = site.name;
                    groupOption.appendChild(option);
                });
                
                usefulUrlsSelect.appendChild(groupOption);
            });
        });
    </script>
</body>
</html>
